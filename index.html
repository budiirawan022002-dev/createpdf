<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Generator PDF 8 Gambar (9:16)</title>
<style>
  :root {
    --blue:#1155ff;
    --page-w: 794px;   /* A4 portrait at ~96dpi */
    --page-h: 1123px;
    --margin: 24px;
    --gap: 12px;
    --header-h: 88px;
  }
  * { box-sizing: border-box; }
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif;
    background:#0b1020;
    color:#111;
    margin:0;
    padding:24px;
    display:flex;
    justify-content:center;
  }
  .app {
    width:min(980px, 100%);
    background:#fff;
    border-radius:16px;
    padding:20px;
    box-shadow:0 10px 30px rgba(0,0,0,.25);
  }
  h1 { margin:0 0 12px; font-size:22px;}
  .row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
  label { font-size:14px; color:#333; margin-bottom:6px; display:block; }
  input[type="text"] {
    width:100%; padding:10px 12px; border:1px solid #d0d5dd; border-radius:10px; font-size:15px;
  }
  input[type="file"] { width:100%; }
  .btns { display:flex; gap:10px; margin-top:12px; }
  button {
    border:0; background:var(--blue); color:white; padding:10px 14px; border-radius:12px; font-weight:600; cursor:pointer;
  }
  button.secondary { background:#eef1ff; color:#1a2b6b; }
  .hint { font-size:12px; color:#666; }
  .page {
    width: var(--page-w);
    height: var(--page-h);
    background:#fff;
    border:1px dashed #d0d5dd;
    border-radius:14px;
    margin:18px auto 0;
    overflow:hidden;
    position:relative;
  }
  .header {
    position:absolute; inset:var(--margin) var(--margin) auto var(--margin);
    height:var(--header-h);
    border-radius:12px;
    background:#1f49ff;
    display:flex; align-items:center; justify-content:center;
    padding:0 18px;
  }
  .header h2 {
    color:white; text-align:center; font-size:28px; line-height:1.2; letter-spacing:.5px; margin:0;
  }
  .grid-wrap {
    position:absolute;
    top: calc(var(--margin) + var(--header-h) + 16px);
    left: var(--margin);
    right: var(--margin);
    bottom: var(--margin);
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(2, 1fr);
    gap: var(--gap);
  }
  .tile {
    background:#f3f4f6;
    border-radius:10px;
    display:flex; align-items:center; justify-content:center;
    overflow:hidden;
    position:relative;
    aspect-ratio: 9 / 16;
  }
  .tile img {
    position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
  }
  .tile .idx {
    position:absolute; top:8px; left:8px; font-size:12px; background:rgba(0,0,0,.5); color:#fff; padding:2px 6px; border-radius:6px;
  }
  .footer-note {
    margin-top:8px; text-align:center; font-size:12px; color:#667085;
  }
</style>
</head>
<body>
  <div class="app">
    <h1>Generator PDF 8 Gambar (9:16) â€“ 4 di atas & 4 di bawah</h1>
    <div class="row">
      <div>
        <label for="title">Judul di header</label>
        <input id="title" type="text" value="Contoh: HIMBAUAN MENJAGA KEAMANAN DAN MENGHINDARI AKSI ANARKIS"  />
      </div>
      <div>
        <label for="files">Pilih 8 gambar (akan auto-crop 9:16)</label>
        <input id="files" type="file" accept="image/*" multiple />
        <div class="hint">Ambil tepat 8 gambar (atau lebih, kami pakai 8 pertama). Gambar otomatis dipotong tengah agar 9:16.</div>
      </div>
    </div>
    <div class="btns">
      <button id="fill">Tampilkan Pratinjau</button>
      <button id="download" class="secondary">Unduh PDF</button>
    </div>
    <div class="footer-note">Tip: Setelah ganti judul/gambar, klik <b>Tampilkan Pratinjau</b> dulu sebelum mengunduh PDF.</div>

    <div id="page" class="page" aria-label="preview">
      <div class="header"><h2 id="headerText">Judul Poster</h2></div>
      <div class="grid-wrap" id="grid"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>
    const headerText = document.getElementById('headerText');
    const titleInput = document.getElementById('title');
    const filesInput = document.getElementById('files');
    const grid = document.getElementById('grid');
    const pageEl = document.getElementById('page');

    function ensureTiles() {
      grid.innerHTML = '';
      for (let i=0; i<8; i++) {
        const d = document.createElement('div');
        d.className = 'tile';
        const b = document.createElement('div');
        b.className = 'idx';
        b.textContent = i+1;
        const img = document.createElement('img');
        img.alt = 'gambar ' + (i+1);
        d.appendChild(img);
        d.appendChild(b);
        grid.appendChild(d);
      }
    }
    ensureTiles();

    function cropToAspect(img, aspect = 9/16, targetW = 900) {
      const iw = img.naturalWidth, ih = img.naturalHeight;
      const srcAspect = iw / ih;
      let sx, sy, sw, sh;
      if (srcAspect > aspect) {
        sh = ih;
        sw = ih * aspect;
        sx = (iw - sw) / 2;
        sy = 0;
      } else {
        sw = iw;
        sh = iw / aspect;
        sx = 0;
        sy = (ih - sh) / 2;
      }
      const scale = targetW / sw;
      const tw = Math.round(sw * scale);
      const th = Math.round(sh * scale);
      const canvas = document.createElement('canvas');
      canvas.width = tw;
      canvas.height = th;
      const ctx = canvas.getContext('2d');
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(img, sx, sy, sw, sh, 0, 0, tw, th);
      return canvas.toDataURL('image/jpeg', 0.92);
    }

    async function filesToCroppedDataURLs(fileList) {
      const files = Array.from(fileList || []).slice(0,8);
      const urls = [];
      for (const f of files) {
        const dataUrl = await new Promise((resolve, reject)=>{
          const reader = new FileReader();
          reader.onload = () => {
            const img = new Image();
            img.onload = () => resolve(cropToAspect(img, 9/16, 900));
            img.onerror = reject;
            img.src = reader.result;
          };
          reader.onerror = reject;
          reader.readAsDataURL(f);
        });
        urls.push(dataUrl);
      }
      while (urls.length < 8) urls.push('');
      return urls;
    }

    async function fillPreview() {
      headerText.textContent = titleInput.value?.trim() || 'Judul Poster';
      const tiles = grid.querySelectorAll('.tile img');
      const dataUrls = await filesToCroppedDataURLs(filesInput.files);
      tiles.forEach((img, idx) => {
        if (dataUrls[idx]) {
          img.src = dataUrls[idx];
          img.style.opacity = 1;
        } else {
          img.removeAttribute('src');
          img.style.opacity = 0.05;
        }
      });
    }

    async function downloadPDF() {
      const canvas = await html2canvas(pageEl, { scale: 2, backgroundColor: '#ffffff' });
      const imgData = canvas.toDataURL('image/jpeg', 0.95);
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: 'portrait', unit: 'pt', format: 'a4' });
      const pageW = pdf.internal.pageSize.getWidth();
      const pageH = pdf.internal.pageSize.getHeight();
      const imgW = pageW;
      const imgH = canvas.height * (imgW / canvas.width);
      const y = (pageH - imgH) / 2;
      pdf.addImage(imgData, 'JPEG', 0, y, imgW, imgH, undefined, 'FAST');
      pdf.save('poster_8_gambar_9x16.pdf');
    }

    document.getElementById('fill').addEventListener('click', fillPreview);
    document.getElementById('download').addEventListener('click', async () => {
      await fillPreview();
      await downloadPDF();
    });

    titleInput.addEventListener('input', () => headerText.textContent = titleInput.value || 'Judul Poster');
  </script>
</body>
</html>
